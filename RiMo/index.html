<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
    <link href="styles/main.css" rel="stylesheet" />

    <script src="cordova.js"></script>
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.mobile.min.js"></script>
    
    <script src="scripts/app.js"></script>
    <script src="scripts/qrcode.min.js"></script>
    <script src="scripts/jquery.min.js"></script>

</head>
<body>
    <!--Home-->
    <div id="tabstrip-home"
        data-role="view"
        data-title="RiMo">
        <div class="view-content" style="text-align:center;">
            
            <h1>Texas Bitcoin Conference 2014</h1>Hackathon<br><br>
            <p><br><br>Ripple Mobile Merchant App<br><br></p><p>It doesn't get much simpler. Just enter the sale details, and present the scan code to your customer for payment.</p>
            <div><a id="skin-change" data-role="button" data-click="app.changeSkin">Flat</a></div>
        </div>
    </div>
    
    <!--Details-->
    <div id="tabstrip-details"
        data-role="view"
        data-title="Scan to Pay">
        <div class="view-content" style="align:center;">            
            <form data-bind="events: { keyup: checkEnter }">
                <ul data-role="listview" data-style="inset" data-bind="invisible: isLoggedIn">
                    <li>
                        <input id="setMerchant" data-role="button" type="button" value="Set Merchant Account" style="width:100%;"/>
                    </li>
                    <li>
                        <small><label id="showMerchant" ></label></small>
                    </li>
                    <li>
                        <label>
                            Amount
                                <input id="amt" type="number" step="any" min="0" onkeypress='validate(event)' pattern="[0-9]*[.,]?[0-9]+" />
                        </label>
                    </li>
                    <li>
                        <label>
                            Currency
                            <select id="unit">
                                <option>USD</option>
                                <option>XRP</option>
                                <option>BTC</option>
                                <option>EUR</option>
                                <option>LTC</option>
                                
                            </select>
                        </label>
                    </li>
                </ul>
            </form>
            <input id="merch" type="hidden" value="rfKbo1ot2JTHKtZCx6VoD1CjQAN1wK19hv"/>
        </div>
    </div>

    <!--Scancode-->
    <div id="tabstrip-scan"
        data-role="view"
        data-title="Scan to Pay">        
        <div class="view-content" style="text-align:center;">
            <ul data-role="listview" data-style="inset">
                <li><p style="text-align:center;">Present the QR Code below to your customer for payment.</p></li>
                <li style="text-align:center;">
                    <div id="qrcode" style="width:200px; height:200px; margin-top:15px;"></div>
                </li>
            </ul>                       
        </div>
    </div>

    <!--Payment-->
    <div id="tabstrip-payment"
        data-role="view"
        data-title="Payments"
        data-model="app.paymentService.viewModel">

        <div class="payment">
            <p class="payment-title">Recent Transactions</p>

            <div class="separator">
                <div class="dark"></div>
                <div class="light"></div>
            </div>

            <ul class="payment-list"
                data-role="listview"
                data-bind="source: paymentDataSource"
                data-template="payment-template">
            </ul>
        </div>
    </div>

    <!--payment template-->
    <script type="text/x-kendo-tmpl" id="payment-template">
        <div>
            <div class="position-left">
                <span class="payment-info date">${day}</span>
            </div>
            <div class="position-right">
                <span class="payment-info">${highTemperature}</span>
                <span class="payment-info">${lowTemperature}</span>
            </div>
            <div class="position-center">
                <span class="payment-icon ${status}"></span>
            </div>
        </div>
    </script>

    <!--Layout-->
    <div data-role="layout" data-id="tabstrip-layout">

        <!--Header-->
        <div data-role="header">
            <div data-role="navbar">
                <span data-role="view-title"></span>
            </div>
        </div>

        <!--Footer-->
        <div data-role="footer">
            <div data-role="tabstrip">
                <a href="#tabstrip-home" data-icon="home">Home</a>
                <a href="#tabstrip-details" data-icon="info">Details</a>              
                <a href="#tabstrip-scan" data-icon="globe">Get Paid</a>         
            </div>
        </div>
    </div>
    
<script type="text/javascript">
        
function validate(evt) {
  var theEvent = evt || window.event;
  var key = theEvent.keyCode || theEvent.which;
  key = String.fromCharCode( key );
  var regex = /[0-9]|\./;
  if( !regex.test(key) ) {
    theEvent.returnValue = false;
    if(theEvent.preventDefault) theEvent.preventDefault();
  }
}
        
var qrcode = new QRCode(document.getElementById("qrcode"), {
	width : 180,
	height : 180
});

function makeCode () {		
	$merchAccount=$('#merch').val();
    $amt2pay=($('#amt').val()!="")?$('#amt').val():"0";
    $unit2pay=$('#unit').val();
    /*console.log("merch: "+$merchAccount);
    console.log("amt: "+$amt2pay);
    console.log("unit: "+$unit2pay);*/
    var uri2pay = kendo.format("https://ripple.com//send?to={0}&amount={1}/{2}",$merchAccount,$amt2pay,$unit2pay);
	//console.log("uri: "+uri2pay);
	qrcode.makeCode(uri2pay);
}

makeCode();

$("#merch").
	on("blur", function () {
		makeCode();
	});        
$("#amt").
	on("blur", function () {
		makeCode();
	});
$("#unit").
	on("blur", function () {
		makeCode();
	});        
        
        
</script>
</body>
</html>
